
auto lo
iface lo inet loopback

allow-hotplug eth0
iface eth0 inet manual

allow-hotplug wlan0
mapping wlan0
  script /usr/local/bin/apscan.sh
  map YOUR_ESSID1,home
# map YOUR_ESSID2,home
# map YOUR_ESSID3,office
  map hotspot0

allow-hotplug wlan1
iface wlan1 inet manual
    pre-up wpa_supplicant -B -i"$IFACE" -c/etc/wpa_supplicant/wpa_supplicant.conf
    post-down wpa_cli -i $IFACE terminate

iface home inet manual
    pre-up wpa_supplicant -B -i"$IFACE" -c/etc/wpa_supplicant/wpa_supplicant.conf
    post-down wpa_cli -i"$IFACE" terminate

#iface office inet manual
#   pre-up wpa_supplicant -B -i"$IFACE" -c/etc/wpa_supplicant/wpa_supplicant.conf
#   post-down wpa_cli -i"$IFACE" terminate

# Hotspot settings wlan0 and eth0
iface hotspot0 inet static
  address 192.168.42.1
  netmask 255.255.255.0
  pre-up systemctl stop dhcpcd.service
  post-up ifup nat0
  post-up ifup services0
  pre-down ifdown services0
  pre-down ifdown nat0
  post-up systemctl start dhcpcd.service

# Nat eth0
iface nat0 inet manual
  up sh -c 'echo 1 > /proc/sys/net/ipv4/ip_forward'
  up iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
  up iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
  up iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
  down iptables -D FORWARD -i wlan0 -o eth0 -j ACCEPT
  down iptables -D FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
  down iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
  down sh -c 'echo 0 > /proc/sys/net/ipv4/ip_forward'

# Hotspot services
iface services0 inet manual
  up service hostapd start /etc/hostapd/hostapd.conf
  up service udhcpd start
  down service udhcpd stop
  down service hostapd stop

